var e=function(t,o){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},e(t,o)};function t(e,t,o,n){return new(o||(o=Promise))((function(i,u){function r(e){try{a(n.next(e))}catch(e){u(e)}}function s(e){try{a(n.throw(e))}catch(e){u(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,s)}a((n=n.apply(e,t||[])).next())}))}function o(e,t){var o,n,i,u,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(s){return function(a){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(r=0)),r;)try{if(o=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,n=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){r.label=s[1];break}if(6===s[0]&&r.label<i[1]){r.label=i[1],i=s;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(s);break}i[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],n=0}finally{o=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var n=function(){function e(e){this.url=null,this.codec=null,this.audioBufferSourceNode=null,this.mediaElementAudioSourceNode=null,this.isReadyToPLay=!1,this.isBuffered=!1,this.isBuffering=!1,this.audioElement=null,this.audioBuffer=null,this.arrayBuffer=null,this.audioBufferDate=null,this.playTimeOffset=0,this.startTime=0,this.playTime=0,this.playedTimePercentage=0,this.state="sound_state_stopped",this.loadingProgress=0,this.duration=null,this.firstTimePlayed=!0,Array.isArray(e.source)?this.source=e.source:this.source=[e.source],void 0!==e.id?this.id=e.id:this.id=this._generateSoundId(),this.loop=e.loop||!1,this.duration=e.duration||null,"function"==typeof e.onLoading?this.onLoading=e.onLoading:this.onLoading=null,"function"==typeof e.onPlaying?this.onPlaying=e.onPlaying:this.onPlaying=null,"function"==typeof e.onStarted?this.onStarted=e.onStarted:this.onStarted=null,"function"==typeof e.onEnded?this.onEnded=e.onEnded:this.onEnded=null,"function"==typeof e.onStopped?this.onStopped=e.onStopped:this.onStopped=null,"function"==typeof e.onPaused?this.onPaused=e.onPaused:this.onPaused=null,"function"==typeof e.onResumed?this.onResumed=e.onResumed:this.onResumed=null,"ArrayBuffer"===typeof e.arrayBuffer&&(this.arrayBuffer=e.arrayBuffer),"AudioBuffer"===typeof e.audioBuffer&&(this.audioBuffer=e.audioBuffer,this.isBuffering=!1,this.isBuffered=!0,this.audioBufferDate=new Date,this.duration=this.getDuration())}return e.prototype.getCurrentTime=function(){var e;return null!==this.audioBufferSourceNode?e=this.audioBufferSourceNode.context.currentTime:null!==this.mediaElementAudioSourceNode&&(e=this.audioElement.currentTime),e},e.prototype.getDuration=function(){var e;return null!==this.audioBufferSourceNode?e=this.audioBufferSourceNode.buffer.duration:null!==this.mediaElementAudioSourceNode&&(e=this.audioElement.duration),e},e.prototype._generateSoundId=function(){return Date.now().toString(36)+Math.random().toString(36).substring(2)},e.SOUND_STATE_STOPPED="sound_state_stopped",e.SOUND_STATE_PAUSED="sound_state_paused",e.SOUND_STATE_PLAYING="sound_state_playing",e}(),i=function(t){function o(e,n){var i=t.call(this,e)||this;return i.code=n||null,Object.setPrototypeOf(i,o.prototype),i}return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}(o,t),o}(Error),u=function(){function e(e){this._audioContext=null,this._audioGraph=null,this.setPersistVolume(e.persistVolume),this._setAutoCreateContextOnFirstTouch(e.createAudioContextOnFirstUserInteraction),this.setLoadPlayerMode(e.loadPlayerMode),this.setAudioContext(e.customAudioContext),null===e.customAudioContext&&this._autoCreateAudioContextOnFirstUserInteraction(),this._createAudioContextOnFirstUserInteraction||this.getAudioContext().catch((function(){throw new i("audio context setup failed")})),this.setAudioGraph(e.customAudioGraph)}return e.prototype.decodeAudio=function(e){return t(this,void 0,void 0,(function(){var t,n;return o(this,(function(o){switch(o.label){case 0:return[4,this.getAudioContext()];case 1:return t=o.sent(),n=t.decodeAudioData(e),[2,Promise.resolve(n)]}}))}))},e.prototype._createAudioContext=function(){var e=this;return new Promise((function(t,o){var n=window.AudioContext||window.webkitAudioContext;try{e._audioContext=new n,t()}catch(e){o(e)}}))},e.prototype._autoCreateAudioContextRemoveListener=function(){document.removeEventListener("touchstart",this._autoCreateAudioContextRemoveListener.bind(this),!1),document.removeEventListener("touchend",this._autoCreateAudioContextRemoveListener.bind(this),!1),document.removeEventListener("mousedown",this._autoCreateAudioContextRemoveListener.bind(this),!1),this.getAudioContext().catch((function(){throw new i("audio context setup failed")}))},e.prototype._autoCreateAudioContextOnFirstUserInteraction=function(){this._createAudioContextOnFirstUserInteraction&&(document.addEventListener("touchstart",this._autoCreateAudioContextRemoveListener.bind(this),!1),document.addEventListener("touchend",this._autoCreateAudioContextRemoveListener.bind(this),!1),document.addEventListener("mousedown",this._autoCreateAudioContextRemoveListener.bind(this),!1))},e.prototype.getAudioContext=function(){var e=this;return new Promise((function(t,o){null===e._audioContext?e._createAudioContext().then((function(){t(e._audioContext)})).catch(o):"suspended"===e._audioContext.state?e._unfreezeAudioContext().then((function(){t(e._audioContext)})):"running"===e._audioContext.state&&t(e._audioContext)}))},e.prototype.setAudioContext=function(e){var t=this;null!==this._audioContext?this._destroyAudioContext().then((function(){t._setAudioContext(e)})):this._setAudioContext(e)},e.prototype._setAudioContext=function(e){this._audioContext=e},e.prototype._destroyAudioContext=function(){return t(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this._audioContext.close()];case 1:return e.sent(),this._audioContext=null,[2]}}))}))},e.prototype._unfreezeAudioContext=function(){return void 0===this._audioContext.suspend?Promise.resolve():this._audioContext.resume()},e.prototype._freezeAudioContext=function(){return void 0===this._audioContext.suspend?Promise.resolve():this._audioContext.suspend()},e.prototype.setAudioGraph=function(e){var t=this;null!==this._audioGraph&&this._destroyAudioGraph(),null===e||"gainNode"in e&&null!==e.gainNode&&void 0!==e.gainNode?this._audioGraph=e:this.getAudioContext().then((function(o){e.gainNode=o.createGain(),t._audioGraph=e}))},e.prototype.getAudioGraph=function(){var e=this;return new Promise((function(t,o){null!==e._audioGraph?t(e._audioGraph):e._createAudioGraph().then((function(o){e._audioGraph=o,t(o)})).catch(o)}))},e.prototype._createAudioGraph=function(){var e=this;return new Promise((function(t,o){e.getAudioContext().then((function(o){e._audioGraph||(e._audioGraph={gainNode:o.createGain()}),e._audioGraph.gainNode.connect(o.destination);var n=e._volume/100;e._changeGainValue(n),t(e._audioGraph)})).catch(o)}))},e.prototype._destroyAudioGraph=function(){null!==this._audioGraph&&this._audioGraph.gainNode.disconnect(),this._audioGraph=null},e.prototype.createAudioBufferSourceNode=function(e,n){return t(this,void 0,void 0,(function(){var t,i,u=this;return o(this,(function(o){switch(o.label){case 0:return[4,this.getAudioContext()];case 1:return t=o.sent(),i=t.createBufferSource(),n.audioBufferSourceNode=i,i.loop=e.loop,i.onended=function(t){e.onSourceNodeEnded(t),u.destroySourceNode(n)},[2]}}))}))},e.prototype.createMediaElementSourceNode=function(e,n){return t(this,void 0,void 0,(function(){var t,u,r=this;return o(this,(function(o){switch(o.label){case 0:return[4,this.getAudioContext()];case 1:t=o.sent();try{u=t.createMediaElementSource(e.mediaElement)}catch(e){throw new i(e)}return n.mediaElementAudioSourceNode=u,u.mediaElement.loop=e.loop,u.mediaElement.onended=function(){e.onSourceNodeEnded(),r.destroySourceNode(n)},[2]}}))}))},e.prototype.connectSourceNodeToGraphNodes=function(e){this.getAudioGraph().then((function(t){e.connect(t.gainNode),"analyserNode"in t&&null!==t.analyserNode&&void 0!==t.analyserNode&&e.connect(t.analyserNode),"delayNode"in t&&null!==t.delayNode&&void 0!==t.delayNode&&e.connect(t.delayNode),"pannerNode"in t&&null!==t.pannerNode&&void 0!==t.pannerNode&&e.connect(t.pannerNode)}))},e.prototype.destroySourceNode=function(e){if(null!==e.audioBufferSourceNode)e.audioBufferSourceNode.disconnect();else{if(null===e.mediaElementAudioSourceNode)throw new i("can't destroy as no source node in sound");e.mediaElementAudioSourceNode.disconnect()}e.audioBufferSourceNode=null},e.prototype.changeVolume=function(e){var t=e.volume,o=e.sound,n=void 0===o?null:o,i=e.forceUpdateUserVolume,u=void 0===i||i;if(this._persistVolume){var r=parseInt(localStorage.getItem("WebAudioAPIPlayerVolume"));isNaN(r)||u?u&&localStorage.setItem("WebAudioAPIPlayerVolume",t.toString()):t=r}var s=t/100;return null!==n?n.audioElement.volume=s:this._changeGainValue(s),this._volume=t,t},e.prototype._changeGainValue=function(e){this.getAudioGraph().then((function(t){t.gainNode.gain.value=e}))},e.prototype._setAutoCreateContextOnFirstTouch=function(e){this._createAudioContextOnFirstUserInteraction=e},e.prototype.setPersistVolume=function(e){this._persistVolume=e},e.prototype.getPersistVolume=function(){return this._persistVolume},e.prototype.setLoadPlayerMode=function(e){this._loadPlayerMode=e},e.prototype.getLoadPlayerMode=function(){return this._loadPlayerMode},e}(),r=function(){function e(){}return e.prototype.getArrayBuffer=function(e){return new Promise((function(t,o){var n=new XMLHttpRequest;n.open("GET",e.url,!0),n.responseType="arraybuffer",n.onload=function(){200===n.status?t(n.response):o(new i(n.statusText,n.status))},n.onprogress=function(t){var o=100/(t.total/t.loaded);e.loadingProgress=o,null!==e.onLoading&&e.onLoading(o,t.total,t.loaded)},n.onerror=function(){o(new i("xhr network error"))},n.send()}))},e}(),s=function(){function e(e){void 0===e&&(e={});var t=this;this._playingProgressRequestId=null,this._playingProgressPreviousTimestamp=0,this._customAudioGraph=null,this._customAudioContext=null,this._postMuteVolume=null,this._isMuted=!1,this._progressTrigger=function(e,o){o-t._playingProgressPreviousTimestamp>=t._playingProgressIntervalTime&&(t._playingProgress(e),t._playingProgressPreviousTimestamp=o),t._playingProgressRequestId=window.requestAnimationFrame((function(o){t._progressTrigger(e,o)}))};var o={volume:80,loopQueue:!1,loopSong:!1,soundsBaseUrl:"",playingProgressIntervalTime:200,playNextOnEnded:!0,audioGraph:null,audioContext:null,stopOnReset:!0,visibilityAutoMute:!1,createAudioContextOnFirstUserInteraction:!0,persistVolume:!0,loadPlayerMode:"player_mode_audio"},n=Object.assign({},o,e);this._volume=n.volume,this._soundsBaseUrl=n.soundsBaseUrl,this._queue=[],this._currentIndex=null,this._playingProgressIntervalTime=n.playingProgressIntervalTime,this._playNextOnEnded=n.playNextOnEnded,this._loopQueue=n.loopQueue,this._loopSong=n.loopSong,this._stopOnReset=n.stopOnReset,this._visibilityAutoMute=n.visibilityAutoMute,this._createAudioContextOnFirstUserInteraction=n.createAudioContextOnFirstUserInteraction,this._persistVolume=n.persistVolume,this._loadPlayerMode=n.loadPlayerMode,void 0!==n.audioContext&&(this._customAudioContext=n.audioContext),void 0!==n.audioGraph&&(this._customAudioGraph=n.audioGraph),this._initialize()}return e.prototype._initialize=function(){var t;switch(this._loadPlayerMode){case e.PLAYER_MODE_AUDIO:if(!this._detectAudioContextSupport())throw new i("audio context is not supported by this device");t=this._webAudioApiOptions();break;case e.PLAYER_MODE_AJAX:if(!this._detectAudioElementSupport())throw new i("audio context is not supported by this device");t=this._webAudioElementOptions()}this._playerAudio=new u(t)},e.prototype._webAudioApiOptions=function(){return{customAudioContext:this._customAudioContext,customAudioGraph:this._customAudioGraph,createAudioContextOnFirstUserInteraction:this._createAudioContextOnFirstUserInteraction,persistVolume:this._persistVolume,loadPlayerMode:this._loadPlayerMode}},e.prototype._webAudioElementOptions=function(){return{customAudioContext:null,customAudioGraph:null,createAudioContextOnFirstUserInteraction:!1,persistVolume:this._persistVolume,loadPlayerMode:this._loadPlayerMode}},e.prototype._detectAudioContextSupport=function(){var e=!1;return(void 0!==window.webkitAudioContext||"undefined"!=typeof AudioContext)&&(e=!0),e},e.prototype._detectAudioElementSupport=function(){return!!document.createElement("audio").canPlayType},e.prototype.addSoundToQueue=function(t){var o=t.soundAttributes,i=t.whereInQueue,u=void 0===i?e.WHERE_IN_QUEUE_AT_END:i,r=new n(o);switch(u){case e.WHERE_IN_QUEUE_AT_END:this._appendSoundToQueue(r);break;case e.WHERE_IN_QUEUE_AT_START:this._prependSoundToQueue(r)}return r},e.prototype._appendSoundToQueue=function(e){this._queue.push(e)},e.prototype._prependSoundToQueue=function(e){this._queue.unshift(e)},e.prototype.resetQueue=function(){this._stopOnReset&&this.stop(),this._queue=[]},e.prototype.reset=function(){this.resetQueue()},e.prototype.getQueue=function(){return this._queue},e.prototype.setVolume=function(t){this._volume=t,this._isMuted=!1;var o=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});null!==o&&o.state===n.SOUND_STATE_PLAYING&&this._playerAudio.changeVolume({volume:t,sound:o,forceUpdateUserVolume:!0})},e.prototype.getVolume=function(){return this._volume},e.prototype.setLoopQueue=function(e){this._loopQueue=e},e.prototype.getLoopQueue=function(){return this._loopQueue},e.prototype.mute=function(){var t=this.getVolume();this._postMuteVolume=t;var o=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});null!==o&&o.state===n.SOUND_STATE_PLAYING&&this._playerAudio.changeVolume({volume:0,sound:o,forceUpdateUserVolume:!1}),this._isMuted=!0},e.prototype.unMute=function(){var t=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});null!==t&&t.state===n.SOUND_STATE_PLAYING&&this._playerAudio.changeVolume({volume:this._postMuteVolume,sound:t,forceUpdateUserVolume:!1}),this._isMuted=!1},e.prototype.isMuted=function(){return this._isMuted},e.prototype.setPosition=function(t){var o=this,n=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});if(null===n)throw new i("position change called, but no current sound found");if(null===n.duration||isNaN(n.duration))this._loadSound(n).then((function(e){var n=e.duration/100*t;o.setPositionInSeconds(n)})).catch((function(e){throw e}));else{var u=n.duration/100*t;this.setPositionInSeconds(u)}},e.prototype.setPositionInSeconds=function(t){var o=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});if(null===o)throw new i("position change called, but no current sound found");o.state===n.SOUND_STATE_PLAYING?this.play({whichSound:o.id,playTimeOffset:t}):o.playTimeOffset=t},e.prototype._loadSound=function(t){var o,n;switch(this._loadPlayerMode){case e.PLAYER_MODE_AUDIO:o=this._loadSoundUsingAudioElement(t);break;case e.PLAYER_MODE_AJAX:o=this._loadSoundUsingRequest(t);break;case e.PLAYER_MODE_FETCH:n=new i(e.PLAYER_MODE_FETCH+" is not implemented yet",1),o=Promise.reject(n)}return o},e.prototype._loadSoundUsingAudioElement=function(e){var t=this;return new Promise((function(o,n){var u,r,s=(u=t._findBestSource(e.source)).url,a=void 0===(r=u.codec)?null:r;if(e.url=s,e.codec=a,e.arrayBuffer=null,null!==e.url){var d=new Audio;d.crossOrigin="anonymous",d.src=e.url,d.controls=!1,d.autoplay=!1,document.body.appendChild(d),e.audioElement=d,e.duration=d.duration,e.isReadyToPLay=!0,t._initializeAudioElementListeners(e),e.audioElement.addEventListener("canplaythrough",(function(){o(e)})),e.audioElement.addEventListener("error",(function(){var e=new i("loading sound failed");n(e)}))}else{var l=new i("sound has no url",1);n(l)}}))},e.prototype._loadSoundUsingRequest=function(e){var t=this;return new Promise((function(o,n){var u,s;if(null!==e.audioBuffer&&o(e),null!==e.arrayBuffer&&null===e.audioBuffer&&t._decodeSound({sound:e}).then((function(e){o(e)})).catch(n),null===e.arrayBuffer&&null===e.audioBuffer){var a=(u=t._findBestSource(e.source)).url,d=void 0===(s=u.codec)?null:s;if(e.url=a,e.codec=d,null!==e.url){var l=new r;e.isBuffering=!0,l.getArrayBuffer(e).then((function(i){e.arrayBuffer=i,t._decodeSound({sound:e}).then((function(e){o(e)})).catch(n)})).catch((function(e){n(e)}))}else{var c=new i("sound has no url",1);n(c)}}}))},e.prototype._initializeAudioElementListeners=function(e){e.audioElement.addEventListener("progress",(function(){e.loadingProgress=e.audioElement.duration})),e.audioElement.addEventListener("timeupdate",(function(){e.duration=e.audioElement.duration}))},e.prototype._decodeSound=function(e){var t=e.sound,o=t.arrayBuffer;return this._playerAudio.decodeAudio(o).then((function(e){return t.audioBuffer=e,t.isBuffering=!1,t.isBuffered=!0,t.audioBufferDate=new Date,t.duration=t.audioBuffer.duration,t.isReadyToPLay=!0,t})).catch((function(e){throw e}))},e.prototype.play=function(t){var o=this,i=void 0===t?{}:t,u=i.whichSound,r=i.playTimeOffset;return new Promise((function(t,i){var s=o._getSoundFromQueue({whichSound:e.CURRENT_SOUND}),a=o._getSoundFromQueue({whichSound:u,updateIndex:!0});if(null===a)throw new Error("no more sounds in array");null===s||s.state!==n.SOUND_STATE_PLAYING&&s.state!==n.SOUND_STATE_PAUSED||s.id===a.id||o._stop(s,n.SOUND_STATE_STOPPED),null!==s&&s.state===n.SOUND_STATE_PLAYING&&s.id===a.id&&o._stop(s,n.SOUND_STATE_PAUSED),null===s||null!==s&&s.id!==a.id?a.firstTimePlayed=!0:a.firstTimePlayed=!1,void 0!==r&&(a.playTimeOffset=r),a.isReadyToPLay?o._play(a).then(t).catch(i):o._loadSound(a).then((function(){o._play(a).then(t).catch(i)})).catch(i)}))},e.prototype._play=function(e){return t(this,void 0,void 0,(function(){var t;return o(this,(function(o){switch(o.label){case 0:return t=this._volume,this._isMuted&&(t=0),this._volume=this._playerAudio.changeVolume({volume:t,sound:e,forceUpdateUserVolume:!1}),null===e.audioBuffer?[3,2]:[4,this._playAudioBuffer(e)];case 1:return o.sent(),[3,4];case 2:return[4,this._playMediaElementAudio(e)];case 3:o.sent(),o.label=4;case 4:return e.state=n.SOUND_STATE_PLAYING,e.startTime=e.getCurrentTime(),e=this._triggerSoundCallbacks(e),[2]}}))}))},e.prototype._playAudioBuffer=function(e){return t(this,void 0,void 0,(function(){var t,n,u,r=this;return o(this,(function(o){switch(o.label){case 0:if(null!==e.audioBufferSourceNode)return[3,4];t={loop:e.loop,onSourceNodeEnded:function(){r._onEnded()}},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._playerAudio.createAudioBufferSourceNode(t,e)];case 2:return o.sent(),[3,4];case 3:throw n=o.sent(),new i(n);case 4:(u=e.audioBufferSourceNode).buffer=e.audioBuffer,this._playerAudio.connectSourceNodeToGraphNodes(u);try{void 0!==e.playTimeOffset?u.start(0,e.playTimeOffset):u.start()}catch(e){throw new i(e)}return[2]}}))}))},e.prototype._playMediaElementAudio=function(e){return t(this,void 0,void 0,(function(){var t,n,u,r=this;return o(this,(function(o){switch(o.label){case 0:if(null!==e.mediaElementAudioSourceNode)return[3,4];t={loop:e.loop,onSourceNodeEnded:function(){r._onEnded()},mediaElement:e.audioElement},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._playerAudio.createMediaElementSourceNode(t,e)];case 2:return o.sent(),[3,4];case 3:throw n=o.sent(),new i(n);case 4:u=e.mediaElementAudioSourceNode,this._playerAudio.connectSourceNodeToGraphNodes(u),void 0===e.playTimeOffset||isNaN(e.playTimeOffset)||(e.audioElement.currentTime=e.playTimeOffset);try{u.mediaElement.play()}catch(e){throw new i(e)}return[2]}}))}))},e.prototype._triggerSoundCallbacks=function(e){var t=this;return null===e.onResumed||e.firstTimePlayed||e.onResumed(e.playTimeOffset),null!==e.onStarted&&e.firstTimePlayed&&e.onStarted(e.playTimeOffset),null!==e.onPlaying?this._playingProgressRequestId=window.requestAnimationFrame((function(o){t._progressTrigger(e,o)})):this._playingProgressRequestId=null,e},e.prototype._onEnded=function(){var t=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});if(null!==t&&t.state===n.SOUND_STATE_PLAYING){var o=this._getSoundFromQueue({whichSound:e.PLAY_SOUND_NEXT,updateIndex:!0});if(null!==t.onEnded){var i=!1;null!==o&&this._playNextOnEnded&&(i=!0),this._loopQueue&&(i=!0),t.onEnded(i)}t.firstTimePlayed=!0,t.playTimeOffset=0,this._stop(t,n.SOUND_STATE_STOPPED),null!==o?this._playNextOnEnded&&this.play({whichSound:e.PLAY_SOUND_NEXT}):(this._currentIndex=0,this._loopQueue&&this.play())}},e.prototype._getSoundFromQueue=function(t){var o,n=void 0===t?{}:t,i=n.whichSound,u=n.updateIndex,r=void 0!==u&&u,s=null,a=null;if(0===this._queue.length)return s;if(void 0===i)a=0,null!==this._currentIndex&&(a=this._currentIndex),s=this._queue[a];else switch(i){case e.CURRENT_SOUND:null!==this._currentIndex&&(s=this._queue[this._currentIndex]);break;case e.PLAY_SOUND_NEXT:void 0!==this._queue[this._currentIndex+1]?(a=this._currentIndex+1,s=this._queue[a]):this._loopQueue&&(a=0,s=this._queue[a]);break;case e.PLAY_SOUND_PREVIOUS:void 0!==this._queue[this._currentIndex-1]?(a=this._currentIndex-1,s=this._queue[a]):this._loopQueue&&(a=this._queue.length-1,s=this._queue[a]);break;case e.PLAY_SOUND_FIRST:this._queue.length>0&&(a=0,s=this._queue[a]);break;case e.PLAY_SOUND_LAST:this._queue.length>0&&(a=this._queue.length-1,s=this._queue[a]);break;default:s=(o=this._findSoundById({soundId:i}))[0],a=o[1]}return null!==a&&r&&(this._currentIndex=a),s},e.prototype._findSoundById=function(e){var t=e.soundId,o=null,n=0;return this._queue.some((function(e,i){if(e.id===t)return o=e,n=i,!0})),[o,n]},e.prototype._findBestSource=function(e){var t=this,o={url:null,codec:null};return(Array.isArray(e)?e:[e]).forEach((function(e){var n="";""!==t._soundsBaseUrl&&(n=t._soundsBaseUrl),n+=e.url;var i=!0;null!==e.codec&&(i=t._checkCodecSupport(e.codec)),i&&(null!==o.url&&e.isPreferred,o.url=n,o.codec=e.codec)})),o},e.prototype._checkCodecSupport=function(e){var t,o="";switch(e){case"ogg":case"oga":t=['audio/ogg; codecs="vorbis"'];break;case"mp3":t=['audio/mpeg; codecs="mp3"'];break;case"opus":t=['audio/ogg; codecs="opus"','audio/webm; codecs="opus"'];break;case"wav":t=['audio/wav; codecs="1"'];break;case"m4a":t=["audio/m4a;","audio/x-m4a;"];break;case"m4p":t=["audio/m4p;","audio/x-m4p;"];break;case"caf":t=["audio/x-caf;"];break;case"aac":t=["audio/aac;"];break;case"weba":case"webm":t=['audio/webm; codecs="vorbis"'];break;case"flac":t=["audio/flac;","audio/x-flac;"];break;default:o="unrecognised codec"}if(o)throw new i(o);return this._checkMimeTypesSupport(t)},e.prototype._checkMimeTypesSupport=function(e){var t=new Audio,o=!1;return e.forEach((function(e){t.canPlayType(e).replace(/^no$/,"")&&(o=!0)})),o},e.prototype.pause=function(){var t=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});if(null!==t&&t.state!==n.SOUND_STATE_PAUSED){var o=t.getCurrentTime();t.playTimeOffset+=o-t.startTime,null!==t.onPaused&&t.onPaused(t.playTimeOffset),this._stop(t,n.SOUND_STATE_PAUSED)}},e.prototype.stop=function(){var t=this._getSoundFromQueue({whichSound:e.CURRENT_SOUND});if(null!==t&&t.state!==n.SOUND_STATE_STOPPED){var o=t.getCurrentTime();t.playTimeOffset+=o-t.startTime,null!==t.onStopped&&t.onStopped(t.playTimeOffset),this._stop(t,n.SOUND_STATE_STOPPED)}},e.prototype._stop=function(e,t){if(t===n.SOUND_STATE_STOPPED&&(e.playTimeOffset=0),null!==e.audioBufferSourceNode)e.audioBufferSourceNode.stop(0);else{if(null===e.mediaElementAudioSourceNode)throw new i("can't stop as no source node in sound");e.mediaElementAudioSourceNode.mediaElement.pause()}this._playerAudio.destroySourceNode(e),e.state=t,null!==this._playingProgressRequestId&&(cancelAnimationFrame(this._playingProgressRequestId),this._playingProgressPreviousTimestamp=0)},e.prototype.next=function(){this.play({whichSound:e.PLAY_SOUND_NEXT})},e.prototype.previous=function(){this.play({whichSound:e.PLAY_SOUND_PREVIOUS})},e.prototype.first=function(){this.play({whichSound:e.PLAY_SOUND_FIRST})},e.prototype.last=function(){this.play({whichSound:e.PLAY_SOUND_LAST})},e.prototype._playingProgress=function(e){var t=e.getCurrentTime();e.playTime=t-e.startTime+e.playTimeOffset;var o=e.getDuration(),n=e.playTime/o*100;e.playedTimePercentage=n,e.onPlaying(n,o,e.playTime)},e.prototype.setAudioGraph=function(e){this._playerAudio.setAudioGraph(e),this._customAudioGraph=e},e.prototype.getAudioGraph=function(){var e=this;return new Promise((function(t,o){e._playerAudio.getAudioGraph().then((function(o){e._customAudioGraph=o,t(o)})).catch(o)}))},e.prototype.setAudioContext=function(e){this._playerAudio.setAudioContext(e),this._customAudioContext=e},e.prototype.getAudioContext=function(){var e=this;return new Promise((function(t,o){e._playerAudio.getAudioContext().then((function(o){e._customAudioContext=o,t(o)})).catch(o)}))},e.prototype.setVisibilityAutoMute=function(e){this._visibilityAutoMute=e,e?document.addEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1):document.removeEventListener("visibilitychange",this._handleVisibilityChange.bind(this),!1)},e.prototype.getVisibilityAutoMute=function(){return this._visibilityAutoMute},e.prototype._handleVisibilityChange=function(){var e;void 0!==document.hidden?e="hidden":void 0!==document.msHidden?e="msHidden":void 0!==document.webkitHidden&&(e="webkitHidden"),document[e]?this.mute():this.unMute()},e.WHERE_IN_QUEUE_AT_END="append",e.WHERE_IN_QUEUE_AT_START="prepend",e.PLAY_SOUND_NEXT="next",e.PLAY_SOUND_PREVIOUS="previous",e.PLAY_SOUND_FIRST="first",e.PLAY_SOUND_LAST="last",e.CURRENT_SOUND="current",e.PLAYER_MODE_AUDIO="player_mode_audio",e.PLAYER_MODE_AJAX="player_mode_ajax",e.PLAYER_MODE_FETCH="player_mode_fetch",e}();export{s as PlayerCore,n as PlayerSound};
//# sourceMappingURL=index.min.js.map
